<!-- ìˆ˜ì •ë¨: bus-info.htmlì„ Angular ng-view í…œí”Œë¦¿ í˜•íƒœë¡œ ìˆ˜ì •
     - <!DOCTYPE>, <html>, <head>, <body>, ng-app ì œê±° (ë¼ìš°íŒ… í…œí”Œë¦¿ì—ì„œ ì¤‘ì²© ng-app/ë¬¸ì„œ íƒœê·¸ë¡œ ì»´íŒŒì¼ ê¹¨ì§ ë°©ì§€)
     - ê¸°ì¡´ ë¦¬ë ˆì´ì•„ì›ƒ UI/ë°”ì¸ë”©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ -->

<div class="container bus-page">
    <!-- ìƒë‹¨: ì œëª©(ì¢Œ) + ìƒíƒœ/ì œì–´(ìš°, í•œ ì¤„ ê³ ì •) -->
    <div class="bus-topbar">
        <div class="bus-topbar-left">
            <h2 class="bus-page-title">ë²„ìŠ¤ ë…¸ì„  ê´€ë¦¬</h2>
        </div>

        <div class="bus-topbar-right">
            <!-- ìƒíƒœ ë°°ì§€ -->
            <span
                class="badge badge-collector"
                ng-class="{'on': (collectorStatus && collectorStatus.running), 'off': !(collectorStatus && collectorStatus.running)}"
            >
                â— ìˆ˜ì§‘: {{ (collectorStatus && collectorStatus.running) ? 'ON' : 'OFF' }}
                <span class="badge-sub" ng-if="collectorStatusText">({{ collectorStatusText }})</span>
            </span>

            <span
                class="badge badge-refresh"
                ng-class="{'on': isAutoRefreshOn, 'off': !isAutoRefreshOn}"
            >
                â†» ìë™ê°±ì‹ : {{ isAutoRefreshOn ? 'ON' : 'OFF' }}
            </span>

            <!-- ì œì–´ ë²„íŠ¼(ìƒë‹¨ í•œ ì¤„) -->
            <div class="top-controls">
                <button
                    type="button"
                    class="btn-top-control btn-top-refresh-on"
                    ng-click="enableAutoRefresh()"
                    ng-disabled="isAutoRefreshOn"
                >
                    â–¶ ìë™ê°±ì‹ 
                </button>

                <button
                    type="button"
                    class="btn-top-control btn-top-refresh-off"
                    ng-click="disableAutoRefresh()"
                    ng-disabled="!isAutoRefreshOn"
                >
                    â¸ ë©ˆì¶¤
                </button>

                <button
                    type="button"
                    class="btn-top-control btn-top-collector"
                    ng-click="toggleCollector()"
                    ng-class="{'running': (collectorStatus && collectorStatus.running)}"
                >
                    {{ (collectorStatus && collectorStatus.running) ? 'â¹ ìˆ˜ì§‘ ì¤‘ì§€' : 'â–¶ ìˆ˜ì§‘ ì‹œì‘' }}
                </button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ: ì¢Œ(ì§€ë„) + ìš°(ì»¨íŠ¸ë¡¤) -->
    <div class="bus-main-grid">
        <!-- ì¢Œì¸¡: ì§€ë„ ì˜ì—­ -->
        <div class="bus-map-area">
            <!-- í˜„ì¬ ê²½ë¡œ ìš”ì•½(ì§€ë„ ìœ„) -->
            <div class="bus-path-strip">
                <strong>[í˜„ì¬ ê²½ë¡œ ì„¤ì •]</strong>
                ì¶œë°œ:
                <span class="path-start">
                    {{ (pathStartStop && (pathStartStop.nodenm || pathStartStop.stationName)) || 'ë¯¸ì„ íƒ' }}
                </span>
                â†’ ë„ì°©:
                <span class="path-end">
                    {{ (pathEndStop && (pathEndStop.nodenm || pathEndStop.stationName)) || 'ë¯¸ì„ íƒ' }}
                </span>

                <span class="path-hint" ng-if="!pathStartStop || !pathEndStop">
                    (ëª©ë¡ì—ì„œ 'ì¶œë°œ'/'ë„ì°©' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„ íƒ)
                </span>

                <span class="path-total" ng-if="pathTotalMinutes != null">
                    ì•½ {{ pathTotalMinutes }}ë¶„
                </span>
            

                <span class="path-breakdown" ng-if="pathPreTransferMinutes != null">
                    (í™˜ìŠ¹ ì „ {{ pathPreTransferMinutes }}ë¶„ / ë„ë³´ {{ pathWalkMinutes }}ë¶„ / í™˜ìŠ¹ í›„ {{ pathPostTransferMinutes }}ë¶„)
                </span>
</div>

            <!-- ì§€ë„ í”„ë ˆì„ -->
            <div class="bus-map-frame">
                <div id="map1" class="bus-map-canvas"></div>

                <div class="map-loading-badge" ng-show="isMapLoading">
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡: ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <aside class="bus-sidebar">
            <!-- 1) ê²€ìƒ‰ & í•„í„° -->
            <section class="sidebar-block">
                <div class="sidebar-title">1. ê²€ìƒ‰ & í•„í„°</div>

                <div class="sidebar-row">
                    <label class="bus-radio-label">
                        <input type="radio" ng-model="searchType" value="route" />
                        <span>ğŸšŒ ë²„ìŠ¤</span>
                    </label>

                    <label class="bus-radio-label">
                        <input type="radio" ng-model="searchType" value="stop" />
                        <span>ğŸš ì •ë¥˜ì¥</span>
                    </label>

                    <button
                        type="button"
                        ng-click="toggleTramLayer()"
                        class="btn-tram-toggle"
                        ng-class="{'active': isTramVisible}"
                    >
                        ğŸš‹ íŠ¸ë¨ {{ isTramVisible ? 'ì§€ìš°ê¸°' : 'ë³´ì´ê¸°' }}
                    </button>
                </div>

                <div class="sidebar-row sidebar-search">
                    <input
                        type="text"
                        ng-model="searchKeyword"
                        class="bus-dashboard-input"
                        placeholder="{{ searchType == 'route' ? 'ë²„ìŠ¤ ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 202)' : 'ì •ë¥˜ì¥ ì´ë¦„ ì…ë ¥' }}"
                        ng-keyup="$event.keyCode == 13 && doSearch()"
                    />

                    <button type="button" ng-click="doSearch()" class="btn-bus-action">
                        ê²€ìƒ‰
                    </button>
                </div>
            </section>

            <!-- 2) ê²½ë¡œ ì„¤ì • -->
            <section class="sidebar-block">
                <div class="sidebar-title">2. ê²½ë¡œ ì„¤ì •</div>

                <div class="path-config">
                    <div class="path-line">
                        <span class="path-label">ì¶œë°œ</span>
                        <span class="path-value">
                            {{ (pathStartStop && (pathStartStop.nodenm || pathStartStop.stationName)) || 'ë¯¸ì„ íƒ' }}
                        </span>
                        <button
                            type="button"
                            class="btn-mini"
                            ng-click="clearPathStart && clearPathStart()"
                            title="ì¶œë°œ ì„ íƒ í•´ì œ"
                        >
                            X
                        </button>
                    </div>

                    <div class="path-line">
                        <span class="path-label">ë„ì°©</span>
                        <span class="path-value">
                            {{ (pathEndStop && (pathEndStop.nodenm || pathEndStop.stationName)) || 'ë¯¸ì„ íƒ' }}
                        </span>
                        <button
                            type="button"
                            class="btn-mini"
                            ng-click="clearPathEnd && clearPathEnd()"
                            title="ë„ì°© ì„ íƒ í•´ì œ"
                        >
                            X
                        </button>
                    </div>


                    <div class="path-line">
                        <span class="path-label">í™˜ìŠ¹</span>
                        <span class="path-value">
                            <input
                                type="number"
                                ng-model="pathMaxTransfers"
                                min="0"
                                max="10"
                                step="1"
                                class="input-mini"
                                title="í—ˆìš© í™˜ìŠ¹ íšŸìˆ˜ (0=ì§í–‰ë§Œ, 1=1íšŒ í™˜ìŠ¹ê¹Œì§€, ...)"
                            />
                            <span class="path-subhint">íšŒ (0=ì§í–‰)</span>
                        </span>
                    </div>

                    <div class="path-actions">
                        <button
                            type="button"
                            ng-click="solvePath()"
                            class="btn-path-action primary"
                            title="ì„ íƒí•œ ì¶œë°œ/ë„ì°© ì •ë¥˜ì¥ìœ¼ë¡œ ê²½ë¡œ íƒìƒ‰"
                        >
                            â–¶ ê²½ë¡œ íƒìƒ‰
                        </button>

                        <button
                            type="button"
                            ng-click="clearResultPath()"
                            class="btn-path-action danger"
                            title="ê²½ë¡œ ë° ì„ íƒ ì´ˆê¸°í™”"
                        >
                            â†º ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </section>

            <!-- 3) ìƒíƒœ & ì œì–´: ì œê±°ë¨ -->

            <!-- 4) ëª©ë¡ ë¦¬ìŠ¤íŠ¸(ì—¬ê¸°ë§Œ ìŠ¤í¬ë¡¤) -->
            <section class="sidebar-block sidebar-list-block">
                <div class="sidebar-title">
                    3. ëª©ë¡ ë¦¬ìŠ¤íŠ¸
                    <span class="sidebar-sub" ng-if="stops && stops.length">(ì´ {{ stops.length }}ê°œ)</span>
                </div>

                <div class="sidebar-list">
                    <ul class="stop-list" ng-if="stops && stops.length">
                        <li
                            ng-repeat="s in stops track by $index"
                            ng-click="selectStop(s)"
                            ng-class="{'active': (selectedStop === s)}"
                        >
                            <div class="stop-left">
                                <div class="stop-name">
                                    <span class="stop-index">{{$index + 1}}.</span>
                                    <span class="stop-title">{{ s.nodenm || s.stationName || 'ì´ë¦„ ì—†ìŒ' }}</span>
                                </div>
                                <div class="stop-id">{{ s.nodeid || s.nodeId }}</div>
                            </div>

                            <div class="stop-actions">
                                <button
                                    type="button"
                                    class="btn-mini start"
                                    ng-click="$event.stopPropagation(); setPathStart(s)"
                                >
                                    ì¶œë°œ
                                </button>
                                <button
                                    type="button"
                                    class="btn-mini end"
                                    ng-click="$event.stopPropagation(); setPathEnd(s)"
                                >
                                    ë„ì°©
                                </button>
                            </div>
                        </li>
                    </ul>

                    <div class="panel-empty-msg" ng-if="!stops || !stops.length">
                        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </section>
        </aside>
    </div>

    <!-- í•˜ë‹¨ ì •ë³´ íŒ¨ë„ -->
    <div class="bus-bottom-sheet">
        <input id="arrivalSheetToggle" type="checkbox" class="sheet-toggle" />

        <label class="sheet-handle" for="arrivalSheetToggle">
            <span class="sheet-title">â±ï¸ ë„ì°© ì˜ˆì • ì •ë³´</span>
            <span class="sheet-sub" ng-if="currentStop">- {{ currentStop.nodenm }}</span>
            <span class="sheet-hint">í´ë¦­í•˜ì—¬ ì—´ê¸°/ë‹«ê¸°</span>
        </label>

        <div class="sheet-body">
            <table class="arrival-info-table" ng-if="arrivalList && arrivalList.length">
                <thead>
                    <tr>
                        <th>ë…¸ì„ </th>
                        <th style="text-align: center">ìœ„ì¹˜</th>
                        <th style="text-align: right">ë„ì°© ì˜ˆì •</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="a in arrivalList">
                        <td><strong>{{ a.routeno || a.routenm || '-' }}</strong></td>
                        <td style="text-align: center">
                            <span class="pill">{{ a.remainStops != null ? a.remainStops + 'ë²ˆì§¸ ì „' : '-' }}</span>
                        </td>
                        <td style="text-align: right">
                            <span class="arrival-highlight" ng-if="a.remainMinutes != null">
                                ì•½ {{ a.remainMinutes }}ë¶„ í›„
                            </span>
                            <span ng-if="a.remainMinutes == null">
                                {{ a.arrtime ? (a.arrtime + 'ì´ˆ í›„') : '-' }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="panel-empty-msg" ng-if="!currentStop">
                ìš°ì¸¡ ëª©ë¡ì—ì„œ ì •ë¥˜ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
            </div>

            <div class="panel-empty-msg" ng-if="currentStop && (!arrivalList || !arrivalList.length)">
                í˜„ì¬ ë„ì°© ì˜ˆì •ì¸ ë²„ìŠ¤ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>
</div>

<!-- ìˆ˜ì •ë¨ ë -->
