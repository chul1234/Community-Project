<div class="container">
    <h1>DB 사용자 관리</h1>
    <hr/>

    <div ng-if="isAdmin">
        
        <div class="action-bar">
            <button type="button" ng-click="fetchAllUsers(1)">사용자 목록 새로고침</button> 
            
            <button type="button" 
                    class="action-btn" 
                    ng-show="!showSearch" 
                    ng-click="openSearch()"
                    style="background-color: #6c757d; color: white; margin-left: auto;">
                🔍 검색
            </button>
            
            <div class="search-bar" style="display: flex; align-items: center; margin-left: auto;" ng-show="showSearch">
                
                <select ng-model="search.type" style="height: 35px; border-radius: 4px; border: 1px solid #ccc; margin-right: 5px;">
                    <option value="user_id">로그인 ID</option>
                    <option value="name">이름</option>
                    <option value="email">이메일</option>
                    <option value="phone">전화번호</option>
                    <option value="role_name">권한명</option>
                </select>
                
                <input type="text" ng-model="search.keyword" placeholder="검색어 입력" style="height: 33px; border: 1px solid #ccc; border-radius: 4px; padding: 0 8px; margin-right: 5px;" />
                
                <button type="button" ng-click="searchUsers()" class="action-btn" style="background-color: #5a6268; color: white;">검색</button>

                <button type="button" 
                        ng-click="closeSearch()" 
                        class="action-btn" 
                        style="background-color: #dc3545; color: white; margin-left: 5px; padding: 6px 10px;">
                    X
                </button>
            </div>
            <div style="display: flex; align-items: center; margin-left: 10px;">
                <select ng-model="pagination.pageSize" 
                        ng-change="pageSizeChanged()" 
                        style="height: 35px; border-radius: 4px; border: 1px solid #ccc; margin-right: 10px;">
                    <option value="5">5개씩 보기</option>
                    <option value="10">10개씩 보기</option>
                    <option value="15">15개씩 보기</option>
                    <option value="20">20개씩 보기</option>
                </select>
                <a href="#!/users/new" class="action-btn create-btn">새 사용자 등록</a>
            </div>
        </div>
        
        <h2>사용자 목록</h2>
        <table class="user-table">
            <thead>
                <tr>
                    <th>로그인 ID (PK)</th>
                    <th>이름</th>
                    <th>전화번호</th>
                    <th>이메일</th>
                    <th>역할</th>
                    <th>작업</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-if="!userList.length && totalItems === 0 && search.keyword">
                    <td colspan="6" style="text-align: center; color: #777;">
                        '{{search.keyword}}'에 대한 검색 결과가 없습니다.
                    </td>
                </tr>
                <tr ng-if="!userList.length && totalItems === 0 && !search.keyword">
                <td colspan="6" style="text-align: center; color: #777;">
                        등록된 사용자가 없습니다.
                    </td>
                </tr>
                <tr ng-repeat="user in userList">
                    <td>{{ user.user_id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.phone }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.role_names || '역할 없음' }}</td>
                    <td>
                        <button ng-click="goToEditPage(user.user_id)">수정</button>
                        <button ng-click="deleteUser(user.user_id)">삭제</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination-container" ng-if="totalPages > 1" style="text-align: center; margin-top: 20px;">
    <button ng-click="goToPage(currentPage - 1)"
            ng-disabled="currentPage === 1"
            style="margin-right: 5px;">
        &lt; 이전
    </button>

    <!-- ▼▼▼ 수정: 한 번에 10개만 보이도록 변경 ▼▼▼ -->  
    <span ng-repeat="page in getPageRange() track by $index" style="margin: 0 2px;"> 
        <a href=""
           ng-click="goToPage(page)"                                                    
           ng-style="{
                'font-weight': (currentPage === page) ? 'bold' : 'normal',             
                'text-decoration': (currentPage === page) ? 'none' : 'underline'      
           }">
            {{ page }}                                                                 
        </a>
    </span>
    <!-- ▲▲▲ 수정 끝 ▲▲▲ -->  

    <button ng-click="goToPage(currentPage + 1)"
            ng-disabled="currentPage === totalPages"
            style="margin-left: 5px;">
        다음 &gt;
    </button>
</div>

    </div>

    <div ng-if="!isAdmin">
        <p style="text-align: center; font-size: 1.2em; color: #777; margin-top: 50px;">
            관리자만 사용 가능한 페이지입니다.
        </p>
    </div>
</div>