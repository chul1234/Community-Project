<div class="container"> <h1>권한 관리</h1>
    <hr />

    <div ng-if="isAdmin">
        <p>이 페이지에서 사용자의 권한을 변경할 수 있습니다. (다중 선택 가능)</p>

        <div class="action-bar" style="justify-content: flex-end;">
            
            <button type="button" 
                    class="action-btn" 
                    ng-show="!showSearch" 
                    ng-click="openSearch()"
                    style="background-color: #6c757d; color: white;">
                🔍 검색
            </button>
            
            <div class="search-bar" style="display: flex; align-items: center;" ng-show="showSearch">
                
                <select ng-model="search.type" style="height: 30px; border-radius: 4px; border: 1px solid #ccc; margin-right: 5px;">
                    <option value="user_id">로그인 ID</option>
                    <option value="name">이름</option>
                    <option value="role_name">권한명</option>
                    </select>
                <input type="text" ng-model="search.keyword" placeholder="검색어 입력" style="height: 28px; border: 1px solid #ccc; border-radius: 4px; padding: 0 8px; margin-right: 5px;" />
                
                <button type="button" ng-click="searchUsers()" class="action-btn" style="background-color: #5a6268; color: white; padding: 4px 8px;">검색</button>

                <button type="button" 
                        ng-click="closeSearch()" 
                        class="action-btn" 
                        style="background-color: #dc3545; color: white; margin-left: 5px; padding: 4px 8px;">
                    X
                </button>
            </div>
            
            <div style="margin-left: 10px;">
                <select ng-model="pagination.pageSize" 
                        ng-change="pageSizeChanged()" 
                        style="height: 30px; border-radius: 4px; border: 1px solid #ccc;">
                    <option value="5">5개씩 보기</option>
                    <option value="10">10개씩 보기</option>
                    <option value="15">15개씩 보기</option>
                    <option value="20">20개씩 보기</option>
                </select>
            </div>
        </div>

        <table class="user-table">
            <thead>
                <tr>
                    <th>로그인 ID</th>
                    <th>이름</th>
                    <th>권한 설정 (체크박스)</th>
                    <th>저장</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-if="!userList.length && totalItems === 0 && search.keyword">
                    <td colspan="4" style="text-align: center; color: #777;">
                        '{{search.keyword}}'에 대한 검색 결과가 없습니다.
                    </td>
                </tr>
                <tr ng-if="!userList.length && totalItems === 0 && !search.keyword">
                    <td colspan="4" style="text-align: center; color: #777;">
                        등록된 사용자가 없습니다.
                    </td>
                </tr>
                <tr ng-repeat="user in userList">
                    <td>{{ user.user_id }}</td>
                    <td>{{ user.name }}</td>
                    <td>
                        <label ng-repeat="role in roleList" style="margin-right: 15px; cursor: pointer;">
                            <input 
                                type="checkbox"
                                ng-checked="isRoleAssigned(user, role.role_id)"
                                ng-click="toggleRoleSelection(user, role.role_id)">
                            {{ role.role_name }}
                        </label>
                    </td>
                    <td>
                        <button ng-click="saveUserRoles(user)">변경사항 저장</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination-container" ng-if="totalPages > 1" style="text-align: center; margin-top: 20px;">
            <button ng-click="goToPage(currentPage - 1)" ng-disabled="currentPage === 1" style="margin-right: 5px;">
                &lt; 이전 </button>
    
            <span ng-repeat="i in getNumber(totalPages) track by $index" style="margin: 0 2px;">
                <a href="" ng-click="goToPage($index + 1)" ng-style="{ 'font-weight': (currentPage === $index + 1) ? 'bold' : 'normal', 'text-decoration': (currentPage === $index + 1) ? 'none' : 'underline' }">
                    {{ $index + 1 }} </a>
            </span>
    
            <button ng-click="goToPage(currentPage + 1)" ng-disabled="currentPage === totalPages" style="margin-left: 5px;">
                다음 &gt; </button>
        </div>
        </div>

    <div ng-if="!isAdmin">
        <p style="text-align: center; font-size: 1.2em; color: #777; margin-top: 50px;">
            관리자만 사용 가능한 페이지입니다.
        </p>
    </div>
</div>